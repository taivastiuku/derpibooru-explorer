/*

 Title: KeyboardJS
 Version: v0.4.1
 Description: KeyboardJS is a flexible and easy to use keyboard binding
 library.
 Author: Robert Hurst.

 Copyright 2011, Robert William Hurst
 Licenced under the BSD License.
 See https://raw.github.com/RobertWHurst/KeyboardJS/master/license.txt
*/
(function(c,A){function B(){function g(f){f=A(f,"amd");f.fork=g;return f}return g(c)}function h(){function g(f){f=A(f,"CommonJS");f.fork=g;return f}module.exports=g(c)}function x(){function g(f){var c,h=[],v={};c=A(f,"global");c.fork=g;c.noConflict=function(){var n,g;g=Array.prototype.slice.apply(arguments);for(n=0;n<h.length;n+=1)"undefined"===typeof v[h[n]]?delete f[h[n]]:f[h[n]]=v[h[n]];v={};for(n=0;n<g.length;n+=1){if("string"!==typeof g[n])throw Error("Cannot replace namespaces. All new namespaces must be strings.");
v[g[n]]=f[g[n]];f[g[n]]=c}return h=g};c.noConflict("KeyboardJS","k");return c}g(c)}[].indexOf||(Array.prototype.indexOf=function(c,f,h){h=this.length;for(f=(h+~~f)%h;f<h&&(!(f in this)||this[f]!==c);f++);return f^h?f:-1});"function"===typeof define&&define.amd?define(B):"undefined"!==typeof module?h():x()})(this,function(c,A){function B(){c.addEventListener?(c.document.addEventListener("keydown",x,!1),c.document.addEventListener("keyup",g,!1),c.addEventListener("blur",h,!1),c.addEventListener("webkitfullscreenchange",
h,!1),c.addEventListener("mozfullscreenchange",h,!1)):c.attachEvent&&(c.document.attachEvent("onkeydown",x),c.document.attachEvent("onkeyup",g),c.attachEvent("onblur",h))}function h(b){s=[];I();v(b)}function x(b){var a,d,e;a=f(b.keyCode);if(!(1>a.length)){b.isRepeat=!1;for(e=0;e<a.length;e+=1)d=a[e],-1!=C().indexOf(d)&&(b.isRepeat=!0),J(d);for(a=0;a<r.length;a+=1)if(d=u(r[a][0]),-1===w.indexOf(r[a])&&y(d))for(w.push(r[a]),d=0;d<r[a][1].length;d+=1)J(r[a][1][d]);var l,c,m,h,k,g;e=[];d=[].concat(s);
for(a=0;a<q.length;a+=1)l=K(q[a].keyCombo).length,e[l]||(e[l]=[]),e[l].push(q[a]);for(l=e.length-1;0<=l;l-=1)if(e[l])for(a=0;a<e[l].length;a+=1){c=e[l][a];m=K(c.keyCombo);g=!0;for(k=0;k<m.length;k+=1)if(-1===d.indexOf(m[k])){g=!1;break}if(g&&y(c.keyCombo)){D.push(c);for(k=0;k<m.length;k+=1)g=d.indexOf(m[k]),-1<g&&(d.splice(g,1),k-=1);for(m=0;m<c.keyDownCallback.length;m+=1)!1===c.keyDownCallback[m](b,C(),c.keyCombo)&&(h=!0);!0===h&&(b.preventDefault(),b.stopPropagation())}}}}function g(b){var a,d;
a=f(b.keyCode);if(!(1>a.length)){for(d=0;d<a.length;d+=1)G(a[d]);I();v(b)}}function f(b){return z[b]||[]}function H(b){for(var a in z)if(z.hasOwnProperty(a)&&-1<z[a].indexOf(b))return a;return!1}function I(){var b,a;for(b=0;b<w.length;b+=1)if(a=u(w[b][0]),!1===y(a)){for(a=0;a<w[b][1].length;a+=1)G(w[b][1][a]);w.splice(b,1);b-=1}}function v(b){var a,d,e,l;for(a=0;a<D.length;a+=1)if(e=D[a],!1===y(e.keyCombo)){for(d=0;d<e.keyUpCallback.length;d+=1)!1===e.keyUpCallback[d](b,C(),e.keyCombo)&&(l=!0);!0===
l&&(b.preventDefault(),b.stopPropagation());D.splice(a,1);a-=1}}function n(b,a){var d,e,l;b=u(b);a=u(a);if(b.length!==a.length)return!1;for(d=0;d<b.length;d+=1){if(b[d].length!==a[d].length)return!1;for(e=0;e<b[d].length;e+=1){if(b[d][e].length!==a[d][e].length)return!1;for(l=0;l<b[d][e].length;l+=1)if(-1===a[d][e].indexOf(b[d][e][l]))return!1}}return!0}function y(b){var a,d,e,l,c=0,m,g;b=u(b);for(a=0;a<b.length;a+=1){g=!0;for(d=c=0;d<b[a].length;d+=1){e=[].concat(b[a][d]);for(l=c;l<s.length;l+=1)m=
e.indexOf(s[l]),-1<m&&(e.splice(m,1),c=l);if(0!==e.length){g=!1;break}}if(g)return!0}return!1}function K(b){var a,d,e=[];b=u(b);for(a=0;a<b.length;a+=1)for(d=0;d<b[a].length;d+=1)e=e.concat(b[a][d]);return e}function u(b){var a=0,d=0,e=!1,c=!1,g=[],m=[],f=[],k="";if("object"===typeof b&&"function"===typeof b.push)return b;if("string"!==typeof b)throw Error('Cannot parse "keyCombo" because its type is "'+typeof b+'". It must be a "string".');for(;" "===b.charAt(a);)a+=1;for(;;){if(" "===b.charAt(a)){for(;" "===
b.charAt(a);)a+=1;e=!0}else if(","===b.charAt(a)){if(d||c)throw Error("Failed to parse key combo. Unexpected , at character index "+a+".");c=!0;a+=1}else if("+"===b.charAt(a)){k.length&&(f.push(k),k="");if(d||c)throw Error("Failed to parse key combo. Unexpected + at character index "+a+".");d=!0;a+=1}else if(">"===b.charAt(a)){k.length&&(f.push(k),k="");f.length&&(m.push(f),f=[]);if(d||c)throw Error("Failed to parse key combo. Unexpected > at character index "+a+".");d=!0;a+=1}else if(a<b.length-
1&&"!"===b.charAt(a)&&(">"===b.charAt(a+1)||","===b.charAt(a+1)||"+"===b.charAt(a+1)))k+=b.charAt(a+1),c=e=d=!1,a+=2;else if(a<b.length&&"+"!==b.charAt(a)&&">"!==b.charAt(a)&&","!==b.charAt(a)&&" "!==b.charAt(a)){if(!1===d&&!0===e||!0===c)k.length&&(f.push(k),k=""),f.length&&(m.push(f),f=[]),m.length&&(g.push(m),m=[]);for(c=e=d=!1;a<b.length&&"+"!==b.charAt(a)&&">"!==b.charAt(a)&&","!==b.charAt(a)&&" "!==b.charAt(a);)k+=b.charAt(a),a+=1}else{a+=1;continue}if(a>=b.length){k.length&&f.push(k);f.length&&
m.push(f);m.length&&g.push(m);break}}return g}function L(b){var a,d,e=[];if("string"===typeof b)return b;if("object"!==typeof b||"function"!==typeof b.push)throw Error("Cannot stringify key combo.");for(a=0;a<b.length;a+=1){e[a]=[];for(d=0;d<b[a].length;d+=1)e[a][d]=b[a][d].join(" + ");e[a]=e[a].join(" > ")}return e.join(" ")}function C(){return[].concat(s)}function J(b){if(b.match(/\s/))throw Error("Cannot add key name "+b+" to active keys because it contains whitespace.");-1<s.indexOf(b)||s.push(b)}
function G(b){var a=H(b);"91"===a||"92"===a?s=[]:s.splice(s.indexOf(b),1)}function M(b,a){if("string"!==typeof b)throw Error("Cannot register new locale. The locale name must be a string.");if("object"!==typeof a)throw Error("Cannot register "+b+" locale. The locale map must be an object.");if("object"!==typeof a.map)throw Error("Cannot register "+b+" locale. The locale map is invalid.");a.macros||(a.macros=[]);E[b]=a}function N(b){if(b){if("string"!==typeof b)throw Error("Cannot set locale. The locale name must be a string.");
if(!E[b])throw Error("Cannot set locale to "+b+" because it does not exist. If you would like to submit a "+b+" locale map for KeyboardJS please submit it at https://github.com/RobertWHurst/KeyboardJS/issues.");z=E[b].map;r=E[b].macros;O=b}return O}var p={},E={},O,z,r,s=[],q=[],D=[],w=[],t,F;c=c||unsafeWindow||window;F={map:{3:["cancel"],8:["backspace"],9:["tab"],12:["clear"],13:["enter"],16:["shift"],17:["ctrl"],18:["alt","menu"],19:["pause","break"],20:["capslock"],27:["escape","esc"],32:["space",
"spacebar"],33:["pageup"],34:["pagedown"],35:["end"],36:["home"],37:["left"],38:["up"],39:["right"],40:["down"],41:["select"],42:["printscreen"],43:["execute"],44:["snapshot"],45:["insert","ins"],46:["delete","del"],47:["help"],91:"command windows win super leftcommand leftwindows leftwin leftsuper".split(" "),92:"command windows win super rightcommand rightwindows rightwin rightsuper".split(" "),145:["scrolllock","scroll"],186:["semicolon",";"],187:["equal","equalsign","="],188:["comma",","],189:["dash",
"-"],190:["period","."],191:["slash","forwardslash","/"],192:["graveaccent","`"],219:["openbracket","["],220:["backslash","\\"],221:["closebracket","]"],222:["apostrophe","'"],48:["zero","0"],49:["one","1"],50:["two","2"],51:["three","3"],52:["four","4"],53:["five","5"],54:["six","6"],55:["seven","7"],56:["eight","8"],57:["nine","9"],96:["numzero","num0"],97:["numone","num1"],98:["numtwo","num2"],99:["numthree","num3"],100:["numfour","num4"],101:["numfive","num5"],102:["numsix","num6"],103:["numseven",
"num7"],104:["numeight","num8"],105:["numnine","num9"],106:["nummultiply","num*"],107:["numadd","num+"],108:["numenter"],109:["numsubtract","num-"],110:["numdecimal","num."],111:["numdivide","num/"],144:["numlock","num"],112:["f1"],113:["f2"],114:["f3"],115:["f4"],116:["f5"],117:["f6"],118:["f7"],119:["f8"],120:["f9"],121:["f10"],122:["f11"],123:["f12"]},macros:[["shift + `",["tilde","~"]],["shift + 1",["exclamation","exclamationpoint","!"]],["shift + 2",["at","@"]],["shift + 3",["number","#"]],["shift + 4",
["dollar","dollars","dollarsign","$"]],["shift + 5",["percent","%"]],["shift + 6",["caret","^"]],["shift + 7",["ampersand","and","&"]],["shift + 8",["asterisk","*"]],["shift + 9",["openparen","("]],["shift + 0",["closeparen",")"]],["shift + -",["underscore","_"]],["shift + =",["plus","+"]],["shift + (",["opencurlybrace","opencurlybracket","{"]],["shift + )",["closecurlybrace","closecurlybracket","}"]],["shift + \\",["verticalbar","|"]],["shift + ;",["colon",":"]],["shift + '",["quotationmark",'"']],
["shift + !,",["openanglebracket","<"]],["shift + .",["closeanglebracket",">"]],["shift + /",["questionmark","?"]]]};for(t=65;90>=t;t+=1)F.map[t]=String.fromCharCode(t+32),F.macros.push(["shift + "+String.fromCharCode(t+32)+", capslock + "+String.fromCharCode(t+32),[String.fromCharCode(t)]]);M("us",F);N("us");B();p.enable=B;p.disable=function(){h();c.removeEventListener?(c.document.removeEventListener("keydown",x,!1),c.document.removeEventListener("keyup",g,!1),c.removeEventListener("blur",h,!1),
c.removeEventListener("webkitfullscreenchange",h,!1),c.removeEventListener("mozfullscreenchange",h,!1)):c.detachEvent&&(c.document.detachEvent("onkeydown",x),c.document.detachEvent("onkeyup",g),c.detachEvent("onblur",h))};p.activeKeys=C;p.on=function(b,a,d){var e={},c,f=[],g,h;"string"===typeof b&&(b=u(b));for(g=0;g<b.length;g+=1){c={};h=L([b[g]]);if("string"!==typeof h)throw Error("Failed to bind key combo. The key combo must be string.");c.keyCombo=h;c.keyDownCallback=[];c.keyUpCallback=[];a&&c.keyDownCallback.push(a);
d&&c.keyUpCallback.push(d);q.push(c);f.push(c)}e.clear=function(){var a;for(a=0;a<f.length;a+=1)q.splice(q.indexOf(f[a]),1)};e.on=function(a){var b={},d,c,e;if("string"!==typeof a)throw Error("Cannot bind callback. The event name must be a string.");if("keyup"!==a&&"keydown"!==a)throw Error('Cannot bind callback. The event name must be a "keyup" or "keydown".');d=Array.prototype.slice.apply(arguments,[1]);for(c=0;c<d.length;c+=1)if("function"===typeof d[c])if("keyup"===a)for(e=0;e<f.length;e+=1)f[e].keyUpCallback.push(d[c]);
else if("keydown"===a)for(e=0;e<f.length;e+=1)f[e].keyDownCallback.push(d[c]);b.clear=function(){var b,c;for(b=0;b<d.length;b+=1)if("function"===typeof d[b])if("keyup"===a)for(c=0;c<f.length;c+=1)f[c].keyUpCallback.splice(f[c].keyUpCallback.indexOf(d[b]),1);else for(c=0;c<f.length;c+=1)f[c].keyDownCallback.splice(f[c].keyDownCallback.indexOf(d[b]),1)};return b};return e};p.clear=function(b){var a,d;for(a=0;a<q.length;a+=1)d=q[a],n(b,d.keyCombo)&&(q.splice(a,1),a-=1)};p.clear.key=function(b){var a,
d,c;if(b)for(a=0;a<q.length;a+=1)for(c=q[a],d=0;d<c.keyCombo.length;d+=1){if(-1<c.keyCombo[d].indexOf(b)){q.splice(a,1);a-=1;break}}else q=[]};p.locale=N;p.locale.register=M;p.macro=function(b,a){if("string"!==typeof b&&("object"!==typeof b||"function"!==typeof b.push))throw Error("Cannot create macro. The combo must be a string or array.");if("object"!==typeof a||"function"!==typeof a.push)throw Error("Cannot create macro. The injectedKeys must be an array.");r.push([b,a])};p.macro.remove=function(b){var a;
if("string"!==typeof b&&("object"!==typeof b||"function"!==typeof b.push))throw Error("Cannot remove macro. The combo must be a string or array.");for(mI=0;mI<r.length;mI+=1)if(a=r[mI],n(b,a[0])){G(a[1]);r.splice(mI,1);break}};p.key={};p.key.name=f;p.key.code=H;p.combo={};p.combo.active=y;p.combo.parse=u;p.combo.stringify=L;return p});
